# Salesforce Attachments Extract - Environment Configuration
#
# Copy this file to .env and customize the values for your environment.
# WARNING: Never commit the .env file to version control! It may contain sensitive information.

# Salesforce org alias to use (from sf CLI authentication)
# This is used as a fallback if --org is not provided on the command line
# Leave empty to use the default org configured in sf CLI
SF_ORG_ALIAS=your-org

# Base output directory for downloaded files and metadata
# This is used as a fallback if --output is not provided on the command line
# Default: ./output
OUTPUT_DIR=./output

# Log file path for execution logs
# Default: ./logs/download.log
LOG_FILE=./logs/download.log

# Download chunk size in bytes for streaming file downloads
# Larger values may improve download speed but use more memory
# Smaller values are more memory-efficient but may be slower
# Default: 8192 (8KB)
CHUNK_SIZE=8192

# Path to existing metadata CSV file (optional)
# If provided, skips the Salesforce query step and uses this CSV directly
# Useful for re-downloading files or processing existing metadata
# The CSV must contain required columns: Id, Name
# Example: METADATA_CSV=./output/metadata/attachments_20250113_120000.csv
# Default: (empty - will query Salesforce)
METADATA_CSV=

# ============================================================
# Query Configuration
# ============================================================

# Maximum number of attachment records to query from Salesforce per batch
# When pagination is enabled (TARGET_COUNT is set), this becomes the batch size
# When pagination is disabled, this is the total limit for a single query
# Default: 100
QUERY_LIMIT=100

# Target number of attachments to retrieve (optional)
# If not set or empty, uses legacy single-query mode with QUERY_LIMIT
# If set, enables pagination to fetch up to this many records using multiple queries
# The system will execute multiple SOQL queries with OFFSET to reach the target
# Example: TARGET_COUNT=1000 with QUERY_LIMIT=200 will execute 5 queries
# Default: (empty - pagination disabled)
TARGET_COUNT=

# Target mode: 'exact' or 'minimum'
# Only used when TARGET_COUNT is configured
# - exact: Fetch exactly TARGET_COUNT records (or all available if less)
#          The final result will be trimmed to match TARGET_COUNT precisely
# - minimum: Fetch at least TARGET_COUNT records (may fetch more in final batch)
#            Keeps all records from all batches, result may exceed TARGET_COUNT slightly
# Default: exact
TARGET_MODE=exact

# ============================================================
# ParentId Filtering Configuration
# ============================================================

# Comma-separated list of Salesforce ID prefixes to filter attachments
# Each prefix should be 3 characters identifying the object type
# Example: aBo for EMS_Attachment__c, 001 for Account, 006 for Opportunity
# Leave empty to disable prefix filtering
# Example: PARENT_ID_PREFIX=aBo,001
PARENT_ID_PREFIX=

# Comma-separated list of exact ParentId values to filter
# Use this to filter attachments for specific parent records
# Leave empty to disable exact ID filtering
# Example: PARENT_IDS=aBo1234567890ABC,aBo9876543210XYZ
PARENT_IDS=

# Filtering strategy: python or soql
# - python: Filter attachments after querying (supports prefix and exact ID filtering)
# - soql: Filter in SOQL query (only supports exact ID filtering, more efficient for large datasets)
# Default: python
FILTER_STRATEGY=python

# ============================================================
# CSV Records Processing Configuration (Optional)
# ============================================================

# Directory containing CSV files with record IDs (column: Id)
# When set and directory exists, enables CSV-based attachment extraction workflow
# Each CSV file will be processed separately with attachments organized by filename
# The tool will:
#   1. Discover all .csv files in this directory
#   2. Extract record IDs from the 'Id' column
#   3. Batch IDs into groups (see BATCH_SIZE below)
#   4. Query attachments using WHERE ParentId IN (...) for each batch
#   5. Download attachments to output/[csv_name]/files/
# Leave empty or comment out to use standard query workflow
# Example: RECORDS_DIR=./records
# Default: (empty - standard workflow)
RECORDS_DIR=

# Number of ParentIds per SOQL query batch in CSV-records mode
# Controls how many IDs are included in each WHERE ParentId IN (...) query
# SOQL queries have a character length limit (~20,000 chars total)
# Each 18-character Salesforce ID uses ~22 chars in the query: '012345678901234ABC',
# Performance considerations:
#   - Larger values (e.g., 500): Fewer queries but longer SOQL strings (risk hitting limit)
#   - Smaller values (e.g., 50): More queries but safer SOQL length
#   - Default 100: Good balance - ~2,000 chars per query (safe margin)
# This setting only applies when RECORDS_DIR is configured
# Default: 100 (recommended for safety)
BATCH_SIZE=100
